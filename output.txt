

Analysis of MERFISH data by Warped Sigmoid, Poisson-Process Mixed-Effects Model (WSPmm)
: 

Loading helper function definitions for preprocessing MERFISH data... 

Loading raw data: 
----------------------------------------

Found 4 HDF5 files.... 
File names:
	mouse 1: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data_SSp//Somatosensory_ACxDev1_CBA-CAJ_FFPE_P12_z0-3_celltyped_filtered_withCCF.hdf5
	mouse 2: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data_SSp//Somatosensory_ACxDev1_CBA-CAJ_FFPE_P18_celltyped_filtered_withCCF.hdf5
	mouse 3: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data_SSp//Somatosensory_ACxDev1_CBA-CAJ_P12_celltyped_filtered_withCCF.hdf5
	mouse 4: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data_SSp//Somatosensory_ACxDev1_CBA-CAJ_P18_celltyped_filtered_withCCF.hdf5
Loading and parsing file for mouse number: 1, 2, 3, 4 

Mean transcript counts per cell for each mouse: 1.637, 1.817, 0.993, 1.166
Mean of means: 1.403
Standard deviation of means: 0.388

Total cells by type (Map My Cells):
------------------------------

      Astro-Epen          CB GABA          CB Glut     CNU-HYa GABA     CNU-HYa Glut     CNU-LGE GABA     CNU-MGE GABA 
            4905               85               20               12                2              672               21 
CTX-CGE/MGE GABA      DG-IMN Glut         filtered          HY GABA           Immune       IT-ET Glut         LSX GABA 
            1483               11            19204               38              361            16440               29 
         MB GABA          MB Glut       MB-HB Sero       MH-LH Glut          MY GABA          MY Glut   NP-CT-L6b Glut 
              79                5                1               16              450               21             4926 
     OB-IMN GABA              OEC        OPC-Oligo           P GABA  TSCRPT_filtered         Vascular          HY Glut 
             153               23             1530              151              112             6939                1 
   HY Gnrh1 Glut           P Glut      Pineal Glut          TH Glut          MB Dopa       OB-CR Glut 
               1                2                7               12                2                3 
----

Number of mice: 4
Cells per mouse: 13940, 18194, 11116, 14467
Means cells per mouse: 14429.25
Total cells: 57717

Transforming raw data into laminar and columnar coordinates: 
----------------------------------------

Mouse number 1: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, centering each patch around the mean point of L5... 
Step 2, rotating each patch so that L4 aligns with the x-axis with anterior in positive y direction... 
Step 3, modeling and flattening laminar curve based on L4... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Mouse number 2: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, centering each patch around the mean point of L5... 
Step 2, rotating each patch so that L4 aligns with the x-axis with anterior in positive y direction... 
Step 3, modeling and flattening laminar curve based on L4... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Mouse number 3: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, centering each patch around the mean point of L5... 
Step 2, rotating each patch so that L4 aligns with the x-axis with anterior in positive y direction... 
Step 3, modeling and flattening laminar curve based on L4... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Mouse number 4: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, centering each patch around the mean point of L5... 
Step 2, rotating each patch so that L4 aligns with the x-axis with anterior in positive y direction... 
Step 3, modeling and flattening laminar curve based on L4... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Transforming raw data into laminar and columnar coordinates: 
----------------------------------------

Mouse number 1: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, centering each patch around the mean point of L5... 
Step 2, rotating each patch so that L4 aligns with the x-axis with anterior in positive y direction... 
Step 3, modeling and flattening laminar curve based on L4... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Initializing Cpp (wspc) model: 
----------------------------------------

warp_precision: 1e-07
eps_: 2.22045e-16
inf_warp: 4.5036e+08
Data structure check passed
Saving tokenized count
Found max bin: 100.000000
Extracted fixed effects:
"hemisphere" "age"
Ref levels:
"left" "p1x"
Created treatment levels
"ref" "right" "p5x" "rightp5x"
Created treatment-to-fix translation matrix
Pre-computed weight matrix rows
Extracted parent grouping variables:
"cortex"
Extracted child grouping variables:
"Calb1" "Dscaml1" "Gad2" "Grik3" "Grm1" "Npsr1" "Pvalb" "Reln" "Rorb" "Slc32a1" "Sox6" "Vip"
Extracted random-effect grouping variables:
"none" "1" "2" "3" "4" "5"
Extracted tokenized count columns
Grabbed size constants for summed count data, total rows: 28800
Initialized columns for summed count data
Initialized count indexes, number of rows with unique model components: 288
Pre-computing bin masks
Creating summed-count data columns ...
Random level 0, 1/6 complete
Random level 1, 2/6 complete
Random level 2, 3/6 complete
Random level 3, 4/6 complete
Random level 4, 5/6 complete
Random level 5, 6/6 complete
Extracted non-NA indexes
Making extrapolation pool ...
row: 960/4800
row: 1920/4800
row: 2880/4800
row: 3840/4800
row: 4800/4800
Extrapolated 'none' rows
Took log of observed counts
Estimated change points with LROcp and found initial parameter estimates for fixed-effect treatments
Built initial beta (ref and fixed-effects) matrices
Initialized random effect warping factors
Made and mapped parameter vector
Number of parameters: 600
Constructed grouping variable IDs
Computed size of boundary vector: 2064
Finished initializing wspc object

Estimating model parameters: 
---------------
Forking available and bootstrap requested.... 
If bootstrapping not desired, set bootstraps.num = 0... 

Running bootstrap fits (with forking): 
Checking feasibility of provided parameters
... tpoints found below buffer
Provided parameters not feasible, searching nearby
Initial boundary distance (want to make >0): -1.02117
Numer of evals: 4
Success code: 2
Final boundary distance: 0.099091
Nearby feasible parameters found!
Performing initial fit of full data
Penalized neg_loglik: 1.70299
Batch 1/50, 6.69926 sec/bs
Batch 2/50, 12.0312 sec/bs
Batch 3/50, 10.1083 sec/bs
Batch 4/50, 4.37853 sec/bs
Batch 5/50, 9.29592 sec/bs
Batch 6/50, 9.11521 sec/bs
Batch 7/50, 8.81815 sec/bs
Batch 8/50, 34.8236 sec/bs
Batch 9/50, 9.58622 sec/bs
Batch 10/50, 4.52749 sec/bs
Batch 11/50, 6.35908 sec/bs
Batch 12/50, 6.3743 sec/bs
Batch 13/50, 8.90265 sec/bs
Batch 14/50, 8.65331 sec/bs
Batch 15/50, 8.55011 sec/bs
Batch 16/50, 10.8299 sec/bs
Batch 17/50, 6.20102 sec/bs
Batch 18/50, 8.77953 sec/bs
Batch 19/50, 4.85423 sec/bs
Batch 20/50, 6.99011 sec/bs
Batch 21/50, 6.3687 sec/bs
Batch 22/50, 32.6584 sec/bs
Batch 23/50, 33.7098 sec/bs
Batch 24/50, 30.9446 sec/bs
Batch 25/50, 6.37325 sec/bs
Batch 26/50, 6.42706 sec/bs
Batch 27/50, 12.2551 sec/bs
Batch 28/50, 2.61501 sec/bs
Batch 29/50, 11.3549 sec/bs
Batch 30/50, 9.0393 sec/bs
Batch 31/50, 10.0598 sec/bs
Batch 32/50, 11.1352 sec/bs
Batch 33/50, 7.18455 sec/bs
Batch 34/50, 4.89843 sec/bs
Batch 35/50, 6.17546 sec/bs
Batch 36/50, 31.3135 sec/bs
Batch 37/50, 4.58373 sec/bs
Batch 38/50, 11.3231 sec/bs
Batch 39/50, 8.40928 sec/bs
Batch 40/50, 5.02146 sec/bs
Batch 41/50, 30.9966 sec/bs
Batch 42/50, 6.13065 sec/bs
Batch 43/50, 4.77571 sec/bs
Batch 44/50, 6.68467 sec/bs
Batch 45/50, 5.711 sec/bs
Batch 46/50, 13.4955 sec/bs
Batch 47/50, 5.48305 sec/bs
Batch 48/50, 11.4029 sec/bs
Batch 49/50, 6.53845 sec/bs
Batch 50/50, 6.7808 sec/bs
All complete!

Setting full-data fit as parameters... 
Checking feasibility of provided parameters
... no tpoints below buffer
... no negative rates predicted
Provided parameters are feasible

Running stats on simulation results: 
----------------------------------------

Grabbing sample results... 
Grabbing parameter values... 
Computing 95% confidence intervals... 
Estimating p-values from bootstraped parameters... 

Stat summary (head only):
------------------------------
                                 parameter   estimate      CI.low   CI.high p.value p.value.adj    alpha.adj significance
1        baseline_cortex_Rt_Calb1_Tns/Blk1 2.85149726 2.807209952 2.8735106       0           0 8.787346e-05          ***
2    beta_Rt_cortex_Calb1_right_X_Tns/Blk1 0.05949593 0.019353219 0.1154969       0           0 8.802817e-05          ***
3      beta_Rt_cortex_Calb1_p5x_X_Tns/Blk1 1.61349883 1.585350786 1.6695011       0           0 8.818342e-05          ***
4 beta_Rt_cortex_Calb1_rightp5x_X_Tns/Blk1 0.19601115 0.115917463 0.2606718       0           0 8.833922e-05          ***
5        baseline_cortex_Rt_Calb1_Tns/Blk2 2.94989461 2.885535310 2.9558542       0           0 8.849558e-05          ***
6    beta_Rt_cortex_Calb1_right_X_Tns/Blk2 0.06637912 0.006346569 0.1121754       0           0 8.865248e-05          ***
----

Analyzing residuals: 
----------------------------------------

Computing residuals... 
Making masks... 
Making plots and saving stats... 

Log-residual summary by grouping variables (head only):
------------------------------
         group      mean        sd  variance
1          all 0.3718917 0.6223554 0.3873262
2 ran_lvl_none 0.3037349 0.5124314 0.2625859
3    ran_lvl_1 0.4041240 0.6545047 0.4283764
4    ran_lvl_2 0.3345120 0.6104688 0.3726721
5    ran_lvl_3 0.5626811 0.7439513 0.5534636
6    ran_lvl_4 0.4536196 0.7042575 0.4959787
----

TPS test results (head only):
------------------------------
               cortex    gene TPS.ref TPS.right TPS.p5x TPS.rightp5x Rt.p5x tpoint.p5x tslope.p5x Rt.right tpoint.right
Calb1.cortex   cortex   Calb1    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE       TRUE     TRUE         TRUE
Dscaml1.cortex cortex Dscaml1    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE       TRUE     TRUE         TRUE
Gad2.cortex    cortex    Gad2    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE       TRUE     TRUE         TRUE
Grik3.cortex   cortex   Grik3    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE      FALSE     TRUE         TRUE
Grm1.cortex    cortex    Grm1    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE      FALSE     TRUE         TRUE
Npsr1.cortex   cortex   Npsr1    TRUE      TRUE    TRUE         TRUE   TRUE       TRUE       TRUE     TRUE         TRUE
               tslope.right Rt.rightp5x tpoint.rightp5x tslope.rightp5x
Calb1.cortex          FALSE        TRUE            TRUE            TRUE
Dscaml1.cortex        FALSE       FALSE            TRUE            TRUE
Gad2.cortex            TRUE        TRUE            TRUE            TRUE
Grik3.cortex           TRUE        TRUE            TRUE            TRUE
Grm1.cortex            TRUE        TRUE            TRUE            TRUE
Npsr1.cortex           TRUE        TRUE            TRUE            TRUE
----

Printing effect distributions: 
----------------------------------------

Warping factors distributions... 
Rate effects distribution... 
Slope effects distribution... 
tpoint effects distribution... 
Making rate-count plots... 

Printing child summary plots: 
----------------------------------------

Making summary plots for cortex: Calb1, Dscaml1, Gad2, Grik3, Grm1, Npsr1, Pvalb, Reln, Rorb, Slc32a1, Sox6, Vip[1] 173000
[1] 172780

mouse: none
rows: 4800
mean: 58.57437
median: 45
mouse: 1
rows: 4800
mean: 43.91417
median: 19
mouse: 2
rows: 4800
mean: 66.745
median: 32.5
mouse: 3
rows: 4800
mean: 27.07542
median: 10
mouse: 4
rows: 4800
mean: 41.43125
median: 21
mouse: 5
rows: 4800
mean: 72.23208
median: 60
mean (young): 44.79146
median (young): 18
mean (5): 72.23208
median (5): 60
mean ratio (young/5): 0.6201048
median ratio (young/5): 0.3[1] 0.6208425
[1] 1.384386
[1] 519824
[1] 0
[1] 692604
[1] 0.7505357
[1] 106629
[1] 0
[1] 105386
numeric(0)
[1] 0.8415866
[1] 1.384386
[1] 0.6208425
