

Analysis of MERFISH data by Warped Sigmoid, Poisson-Process Mixed-Effects Model (WSPmm)
: 

Loading helper function definitions for preprocessing MERFISH data... 
Setting flag to remove Layer 1 from the analysis... 

Loading raw data: 
----------------------------------------

Found 3 HDF5 files.... 
File names:
	mouse 1: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data//ACxDev1_CBA-CAJ_FFPE_P18_celltyped_filtered_withCCF.hdf5
	mouse 2: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data//ACxDev1_CBA-CAJ_P12_celltyped_filtered_withCCF.hdf5
	mouse 3: /Users/michaelbarkasi/Library/CloudStorage/OneDrive-WashingtonUniversityinSt.Louis/projects_Oviedo_lab/MERFISH/data//ACxDev1_CBA-CAJ_P18_celltyped_filtered_withCCF.hdf5
Loading and parsing file for mouse number: 1, 2, 3 

Mean transcript counts per cell for each mouse: 1.902, 0.897, 1.216
Mean of means: 1.338
Standard deviation of means: 0.514

Total cells by type (Map My Cells):
------------------------------

      Astro-Epen          CB GABA          CB Glut     CNU-HYa GABA 
             924               17               19                9 
    CNU-LGE GABA CTX-CGE/MGE GABA      DG-IMN Glut         filtered 
               4              474                7             5620 
         HY GABA           Immune       IT-ET Glut         LSX GABA 
              10              104             5527                9 
         MB GABA          MY GABA          MY Glut   NP-CT-L6b Glut 
              16              153                2             1086 
      OB-CR Glut      OB-IMN GABA        OPC-Oligo           P GABA 
               0               45              145               52 
         TH Glut         Vascular     CNU-HYa Glut     CNU-MGE GABA 
               1             1444                1                6 
   HY Gnrh1 Glut          MB Dopa       MH-LH Glut              OEC 
               2                2                8               13 
          P Glut      Pineal Glut       MB-HB Sero 
               2                5                1 
----

Number of mice: 3
Cells per mouse: 5759, 4514, 5435
Means cells per mouse: 5236
Total cells: 15708

Transforming raw data into laminar and columnar coordinates: 
----------------------------------------

Mouse number 1: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, correcting perspective to ensure right hemisphere is on the right... 
Step 2, centering each patch around the mean point of L5... 
Step 3, rotating each patch so that L4 aligns with the x-axis and L1 (or L23, if L1 removed) is on top... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Mouse number 2: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, correcting perspective to ensure right hemisphere is on the right... 
Step 2, centering each patch around the mean point of L5... 
Step 3, rotating each patch so that L4 aligns with the x-axis and L1 (or L23, if L1 removed) is on top... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 

Mouse number 3: 
Performing coordinate transform... 
Grabbing coordinates and defining layers and hemispheres... 
Step 1, correcting perspective to ensure right hemisphere is on the right... 
Step 2, centering each patch around the mean point of L5... 
Step 3, rotating each patch so that L4 aligns with the x-axis and L1 (or L23, if L1 removed) is on top... 
Step 4, linearly transforming each patch to vertically straighten them while preserving area... 
Step 5, leveling all layers... 
Binning transformed coordinates... 
Smoothing bin edges with nonlinear transformation... 
Estimating layer boundaries... 
Running checks... 
Initializing Cpp (wspc) model... Data structure check passed
Saving tokenized count
Found max bin: 100.000000
Extracted fixed effects:
"hemisphere" "age"
Ref levels:
"left" "12"
Created treatment levels
"ref" "right" "18" "right18"
Created treatment-to-fix translation matrix
Pre-computed weight matrix rows
Extracted parent grouping variables:
"cortex"
Extracted child grouping variables:
"Arc" "Bcl11b" "Camk2a" "Dlx2" "Fezf2" "Grin2a" "Ncdn" "Nptxr" "Nr4a2" "Rorb" "Satb2"
Extracted random-effect grouping variables:
"none" "1" "2" "3"
Extracted tokenized count columns
Grabbed size constants for summed count data, total rows: 17600
Initialized columns for summed count data
Initialized count indexes, number of rows with unique model components: 176
Pre-computing bin masks
Creating summed-count data columns ...
Random level 0, 1/4 complete
Random level 1, 2/4 complete
Random level 2, 3/4 complete
Random level 3, 4/4 complete
Extracted non-NA indexes
Making extrapolation pool ...
row: 440/4400
row: 880/4400
row: 1320/4400
row: 1760/4400
row: 2200/4400
row: 2640/4400
row: 3080/4400
row: 3520/4400
row: 3960/4400
row: 4390/4400
Extrapolated 'none' rows
Took log of observed counts
Arc
Bcl11b
Camk2a
Dlx2
Fezf2
Grin2a
Ncdn
Nptxr
Nr4a2
Rorb
Satb2
Estimated change points with LROcp and found initial baseline parameters
Built initial beta (ref and fixed-effects) matrices
Initialized random effect warping factors
Made and mapped parameter vector
Constructed grouping variable ids
Computed size of rRsum boundary vector: 1259
Finished initializing wspc object


Estimating model paarameters: 
---------------


Running bootstrap fits (forking): 
Batch 0/10, 0.710045 sec/bs
Batch 1/10, 0.63257 sec/bs
Batch 2/10, 0.607287 sec/bs
Batch 3/10, 0.544531 sec/bs
Batch 4/10, 0.615111 sec/bs
Batch 5/10, 0.579356 sec/bs
Batch 6/10, 0.684694 sec/bs
Batch 7/10, 0.578463 sec/bs
Batch 8/10, 0.651499 sec/bs
Batch 9/10, 0.614667 sec/bs
All complete!

Setting median bootstrap estimates as parameters... 
Checking feasibility of provided parameters
Provided parameters are feasible


Running stats on bootstrap results: 
----------------------------------------

Grabbing bootstrap results, all resamples... 
Grabbing parameter values... 
Computing 95% confidence intervals... 
Estimating p-values from bootstraped parameters... 

Stat summary (head only):
------------------------------
                              parameter     estimate       CI.low     CI.high
1       baseline_cortex_Rt_Arc_Tns/Blk1 6.8723803651  6.871308036 6.873483611
2   beta_Rt_cortex_Arc_right_X_Tns/Blk1 0.0207819338  0.018882550 0.021779969
3      beta_Rt_cortex_Arc_18_X_Tns/Blk1 0.0006074112 -0.002746091 0.002136419
4 beta_Rt_cortex_Arc_right18_X_Tns/Blk1 0.0152353766  0.013325883 0.016466170
5       baseline_cortex_Rt_Arc_Tns/Blk2 5.9954686916  5.993026083 5.997927409
6   beta_Rt_cortex_Arc_right_X_Tns/Blk2 0.0271048210  0.024995723 0.028757225
    p.value p.value.adj    alpha.adj significance
1 0.0000000    0.000000 0.0001336898          ***
2 0.0000000    0.000000 0.0001340483          ***
3 0.0990099    3.663366 0.0013513514           ns
4 0.0000000    0.000000 0.0001344086          ***
5 0.0000000    0.000000 0.0001347709          ***
6 0.0000000    0.000000 0.0001351351          ***
----

Analyzing residuals: 
----------------------------------------

Computing residuals... 
Making masks... 
Making plots and saving stats... 

Log-residual summary by grouping variables (head only):
------------------------------
          group        mean        sd  variance
1           all  0.01822752 0.5962499 0.3555139
2  ran_lvl_none  0.09745063 0.7021154 0.4929661
3     ran_lvl_1 -0.05115472 0.4551498 0.2071614
4     ran_lvl_2 -0.01733032 0.5565636 0.3097630
5     ran_lvl_3 -0.03527862 0.5036190 0.2536321
6 treatment_ref  0.23373427 0.6578699 0.4327928
----

Can't make TPS table without running stats... 

Printing structural summary distributions: 
----------------------------------------

Warping factors, beta distributions... 
Rate effects, gamma distribution... 
Slope effects, gamma distribution... 
tpoint effects, Gaussian distribution... 
Making rate-count plots... 
Printing child summary plots: 
----------------------------------------


Making summary plots for cortex: Arc, Bcl11b, Camk2a, Dlx2, Fezf2, Grin2a, Ncdn, Nptxr, Nr4a2, Rorb, Satb2